"use strict";function asyncGeneratorStep(e,t,i,o,s,n,r){try{var a=e[n](r),l=a.value}catch(e){return void i(e)}a.done?t(l):Promise.resolve(l).then(o,s)}function _asyncToGenerator(e){return function(){var t=this,i=arguments;return new Promise(function(o,s){var n=e.apply(t,i);function r(e){asyncGeneratorStep(n,o,s,r,a,"next",e)}function a(e){asyncGeneratorStep(n,o,s,r,a,"throw",e)}r(void 0)})}}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class MailchimpSoftGate{constructor(e,t,i){_defineProperty(this,"mcApi","https://us-central1-rapplerinternal.cloudfunctions.net/mailchimp-api-dev-subscribe"),_defineProperty(this,"title","Subscribe to our newsletters"),_defineProperty(this,"eyebrow","Join our Newsletter"),_defineProperty(this,"isHidden",!0),_defineProperty(this,"htmlTemplate",'<div id="main__form" style="width: 100%;background-color: rgb(24, 33, 58); padding: 20px; z-index: 100000000; position: fixed; bottom:0; display:block">\n                        <p color="#f04f3c"  class="iSnMqy">%eyebrow%</p>\n                        <a class="close_btn" id="widget-close-btn" style="cursor: pointer; color: #fff;position: absolute; right: 20px; top: 18px;">x</a>\n                        <p id="the__title" class="dTDfwu" style="display: block">%title%</p>\n                        <div class="ROVLC" id="email-widget-form">\n                            <div class="eTaZYM" style="margin:10px 0;"><label for="newsletter-690-email" class="khBOVJ">ENTER EMAIL ADDRESS...<span class="cRXTAb">*</span></label><input type="email" id="softGateEmail" name="softGateEmail" placeholder="ENTER EMAIL ADDRESS... *" class="cUBCJW" value="" required></div>\n                            <p class="gmHjMk" id="input_validation" style="color: #fff; display: none; font-family:inherit; font-size: 12px; text-transform: uppercase; letter-spacing: 2.5px; margin: 0 0 10px 0;"></p>\n                            <button id="widget-submit-button" style="border: none; position: relative; width: 100%; background-color: rgb(240, 79, 60); text-transform: uppercase; color: rgb(24, 33, 58); text-align: center; font-family: TuskerGrotesk-6500Medium; font-size: 0.75rem; letter-spacing: 2.5px; line-height: 17px; height: auto; padding: 12px 0px; box-sizing: border-box; display: inline-block; .eTaZYM::before { border-color: rgba(240, 79, 60, 0.8); } .eTaZYM::after { border-color: rgba(240, 79, 60, 0.5); }; cursor: pointer;" class="eifakh cta-subscribe" >Sign up now</button>\n                        </div>\n                        <p class="gkLkfd" style="text-align: left; margin-top: 24px; font-size: 0.75rem; letter-spacing: 0px; line-height: 20px; color: rgb(255, 255, 255);">By signing up, you agree to and acknowledge our <a href="/about/rappler-privacy-statement" style="color: #fff;" class="bXCXGp" target="__blank" rel="noopener">Privacy Policy</a>.</p>\n                    </div>'),e&&(this.eyebrow=e),t&&(this.title=t),"function"==typeof i&&(this.afterSuccess=i),this.subscribeToMailchimp=this.subscribeToMailchimp.bind(this),this.destroy=this.destroy.bind(this)}subscribeToMailchimp(){var e=this;return _asyncToGenerator(function*(){let t=document.getElementById("softGateEmail").value;if(console.log("clicked"),e._isEmailValid(t)){let i=`${e.mcApi}?email=${t}`,o=yield fetch(i),s=yield o.json();"ok"==s.status?(e.widgetTitle.innerHTML="You're all set, <br /> Thank you for subscribing!",e._toggleNodeVisibility(e.widgetForm),e._toggleNodeVisibility(e.validationMessage),e.afterSuccess(s.result),setTimeout(()=>{e.destroy()},5e3)):(e._displayValidation(s.msg),e.widgetButton.removeAttribute("disabled"))}else e._displayValidation("Invalid email address")})()}destroy(){this.parentWidget.remove()}render(){let e=this.htmlTemplate;e=(e=e.replace("%eyebrow%",this.eyebrow)).replace("%title%",this.title);let t=this._stringToHTML(e);document.getElementsByTagName("body")[0].append(t),this._setDomTraversalNodes(),this._setActions()}_stringToHTML(e){var t=document.createElement("template");return e=e.trim(),t.innerHTML=e,t.content.firstChild}_setDomTraversalNodes(){this.parentWidget=document.getElementById("main__form"),this.widgetForm=document.getElementById("email-widget-form"),this.validationMessage=document.getElementById("input_validation"),this.widgetButton=document.getElementById("widget-submit-button"),this.widgetTitle=document.getElementById("the__title"),this.closeButton=document.getElementById("widget-close-btn")}_setActions(){this.widgetButton.onclick=this.subscribeToMailchimp,this.closeButton.onclick=this.destroy}_displayValidation(e){this.validationMessage.innerText=e,this.validationMessage.style.display="block"}_toggleNodeVisibility(e){e.style.display="block"===window.getComputedStyle(e).display?"none":"block"}_isEmailValid(e){e=e.trim();return/(?:[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/.test(e)}}
